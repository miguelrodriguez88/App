<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linea 3 - Segmento 1 - Parte Fija - Lado Derecho</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">
            <img src="LogoTerniumColor.png" alt="Logo">
            <h1 class="nombre">Linea 3 - Segmento 1 - Parte Fija - Lado Derecho</h1>
        </div>
    </header>

    <div class="container">
        <!-- Secciones de entrada de datos -->
        <div class="input-group" data-id="distribuidor2">
            <label for="distribuidor2">Distribuidor:</label>
            <input type="text" id="distribuidor2">
            <input type="file" accept="image/*" id="Photo2-distribuidor2">
            <img id="preview2-distribuidor2" style="display:none;">
            <button id="delete-distribuidor2" class="delete-button" style="display:none;">Eliminar Foto</button>
        </div>

        <div class="input-group" data-id="canerias2">
            <label for="canerias2">Canerías:</label>
            <input type="text" id="canerias2">
            <input type="file" accept="image/*" id="Photo2-canerias2">
            <img id="preview2-canerias2" style="display:none;">
            <button id="delete-canerias2" class="delete-button" style="display:none;">Eliminar Foto</button>
        </div>

        <div class="input-group" data-id="mangueras2">
            <label for="mangueras2">Mangueras:</label>
            <input type="text" id="mangueras2">
            <input type="file" accept="image/*" id="Photo2-mangueras2">
            <img id="preview2-mangueras2" style="display:none;">
            <button id="delete-mangueras2" class="delete-button" style="display:none;">Eliminar Foto</button>
        </div>

        <button onclick="guardarDatos()">Guardar Datos</button>
        <button onclick="limpiarCampos()">Limpiar Todo</button>
        <button id="export-buttonclick">Exportar a PDF</button><br>
        <button onclick="volverAPaginaAnterior()">Volver a Página Anterior</button>
        <button onclick="volverAlInicio()">Volver a la Página Principal</button>
    </div>

    <script>
        // Cargar datos almacenados al cargar la página
        function cargarDatos() {
            document.querySelectorAll('.input-group').forEach(group => {
                const id = group.dataset.id;
                const comment = localStorage.getItem(id) || '';
                const photo = localStorage.getItem(id + 'Photo2') || '';

                if (comment) {
                    group.querySelector('input[type="text"]').value = comment;
                }
                if (photo) {
                    const img = group.querySelector('img');
                    img.src = photo;
                    img.style.display = 'block';
                    group.querySelector('.delete-button').style.display = 'inline-block';
                }
            });
        }

        // Función para previsualizar y guardar foto y texto en localStorage
        function manejarInput(event) {
            const group = event.target.closest('.input-group');
            const id = group.dataset.id;
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                const img = group.querySelector('img');
                img.src = e.target.result;
                img.style.display = 'block';
                group.querySelector('.delete-button').style.display = 'inline-block';

                // Guardar imagen en localStorage
                localStorage.setItem(id + 'Photo2', e.target.result);
            };

            if (file) {
                reader.readAsDataURL(file);
            }

            // Guardar comentario en localStorage
            const comment = group.querySelector('input[type="text"]').value;
            localStorage.setItem(id, comment);
        }

        // Función para eliminar foto y limpiar localStorage
        function eliminarFoto(event) {
            const group = event.target.closest('.input-group');
            const id = group.dataset.id;

            group.querySelector('img').src = '';
            group.querySelector('img').style.display = 'none';
            group.querySelector('input[type="file"]').value = '';
            event.target.style.display = 'none';

            // Eliminar datos del localStorage
            localStorage.removeItem(id + 'Photo2');
        }

        // Guardar todos los datos en localStorage
        function guardarDatos() {
            document.querySelectorAll('.input-group').forEach(group => {
                const id = group.dataset.id;
                const comment = group.querySelector('input[type="text"]').value;
                localStorage.setItem(id, comment);
            });
            alert("Datos guardados correctamente.");
        }

        // Limpiar todos los campos y localStorage
        function limpiarCampos() {
            document.querySelectorAll('.input-group').forEach(group => {
                const id = group.dataset.id;
                group.querySelector('input[type="text"]').value = '';
                eliminarFoto({ target: group.querySelector('.delete-button') });
                localStorage.removeItem(id);
            });
            alert("Todos los datos han sido eliminados.");
        }

        // Exportar datos a PDF
        document.getElementById('export-buttonclick').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(16);

            const logoImage = document.querySelector('.logo img').src;
            doc.addImage(logoImage, 'PNG', 20, 10, 60, 25);
            doc.text("Linea 3 - Segmento 1 - Parte Fija - Lado Derecho", 20, 50);

            document.querySelectorAll('.input-group').forEach((group, index) => {
                const id = group.dataset.id;
                const comment = localStorage.getItem(id) || '';
                const photo = localStorage.getItem(id + 'Photo2');

                doc.text(`${id}: ${comment}`, 20, 70 + index * 80);

                if (photo) {
                    doc.addImage(photo, 'JPEG', 20, 80 + index * 80, 50, 50);
                }
            });

            doc.save('Linea 3 - Segmento 1 - Parte Fija - Lado Derecho.pdf');
        });

        // Funciones de redirección
        function volverAlInicio() {
            window.location.href = 'Linea 3 - Segmentos.html';
        }
        function volverAPaginaAnterior() {
            window.history.back();
        }

        // Inicializar eventos al cargar la página
        window.onload = function() {
            cargarDatos();
            document.querySelectorAll('input[type="file"]').forEach(input => {
                input.addEventListener('change', manejarInput);
            });
            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', eliminarFoto);
            });
        };
    </script>
</body>
</html>
